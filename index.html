<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√Årvore Geneal√≥gica</title>
    
    <link rel="stylesheet" href="arvore_style.css">
    <!-- Removido o link do Tailwind CSS para manter seus estilos originais -->
    <script src="arvore_script.js" defer></script>
</head>
<div id="welcomeOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); z-index:9999; flex-direction:column; align-items:center; justify-content:center; text-align:center; font-family:serif;">
    <h2 style="color: #2d5a27;">üå≥ Bem-vindo √† nossa Hist√≥ria</h2>
    <p id="welcomeText" style="font-size: 1.2em; color: #555;">Carregando os v√≠nculos e mem√≥rias da Fam√≠lia...</p>
    <div style="margin-top:20px; color:#888;">Aguarde um instante...</div>
</div>

<script src="dados_iniciais.js"></script>

<script>
function verificarCargaInicial() {
    const CHAVE = 'arvoreGenealogica';
    const rawData = localStorage.getItem(CHAVE);
    const overlay = document.getElementById('welcomeOverlay');

    // CONDI√á√ÉO BLINDADA: S√≥ entra se for null, undefined ou um array vazio "[]"
    const estaVazio = !rawData || rawData === "[]" || rawData === "undefined";

    if (estaVazio && typeof SEED_DA_FAMILIA !== 'undefined' && SEED_DA_FAMILIA.length > 0) {
        
        // Trava de seguran√ßa: verificamos se j√° tentamos carregar nesta sess√£o
        if (sessionStorage.getItem('jaTentouCarregar')) return;
        sessionStorage.setItem('jaTentouCarregar', 'true');

        overlay.style.display = 'flex';
        localStorage.setItem(CHAVE, JSON.stringify(SEED_DA_FAMILIA));

        // Seus 2000 mSeg (2 segundos) de cortesia
        setTimeout(() => {
            overlay.style.display = 'none';
            location.reload();
        }, 2000);
    }
}

// Inicia a verifica√ß√£o assim que a p√°gina carregar
window.addEventListener('load', verificarCargaInicial);
</script>

<body>
    <div id="loadingMessage" style="display:none; position:fixed; top:0; left:0; width:100%; background:#fff3cd; color:#664d03; font-weight:bold; text-align:center; padding:1em; z-index:1000; border-bottom: 1px solid #ffc107;">Carregando...</div>
    <div class="container">
        <header>
            <h1>üå≥ √Årvore Geneal√≥gica</h1>
            <p>Para configurar e lembrar a hist√≥ria da fam√≠lia</p>
            
        </header>

        <nav>
            <button id="btnRefugio" style="display: none;">üè† In√≠cio</button>
            <!-- BOT√ÉO DE ACESSO R√ÅPIDO: Lista de Pessoas -->
            <button id="btnListaPessoasVisu" style="display: none;">üîç Lista/Pessoas</button>
        </nav>
        
        <section id="secAbertura">
            <img src="arvore_familia.png" alt="√Årvore Geneal√≥gica da Fam√≠lia" class="imagem-abertura">
            
            <!-- Container que permite o alinhamento horizontal (FLEX) -->
            <div id="hub-botoes"> 
                <button id="btnGerenciarHub" class="hub-button">üìúüîç - Lista de Pessoas</button>
                <button id="btnNovaPessoaHub" class="hub-button">‚ûï Incluir Nova Pessoa</button>
                <button id="btnVerAniversarios" class="hub-button">üéÇ Aniversariantes do M√™süéàüéà</button>
            <p>(os dados ficam somente no dispositivo)</p>
            </div>
        </section>
        
        <section id="secNovaPessoa">
            <h2>Incluindo Nova Pessoa</h2>
            <form id="pessoaForm">
                <label>Nome completo:</label>
                <input type="text" id="nome" required>
                <label>Sexo:</label>
                <select id="sexo">
                    <option value="">Selecione...</option>
                    <option value="M">Masculino</option>
                    <option value="F">Feminino</option>
                </select>
                <label>Nascimento:</label>
                <input type="text" id="nascimento" placeholder="DD/MM/AAAA">
                <label>Falecimento (opcional):</label>
                <input type="text" id="falecimento">
                <label>Profiss√£o (opcional):</label>
                <input type="text" id="profissao">
                <label>Cidade/Pa√≠s principal (opcional):</label>
                <input type="text" id="cidade_pais">

                <!-- CAMPO DE NOTAS -->
                <label>NOTAS (Uso Pessoal):</label>
                <textarea id="observacoes" rows="4" style="width: 100%;"></textarea>

                <button type="submit">Salvar Registro</button>
                <button type="button" id="btnCancelarInclusao">Cancelar</button>
            </form>
            <div id="registroAtualContainer">Nenhum registro criado nesta sess√£o.</div>
        </section>
        
        <section id="secGerenciar">
            <h2>Registros</h2>
            
            <!-- CONTAINER: Agrupa os filtros -->
            <div id="filtrosContainer">
                
                <div class="filtro-grupo">
                    <label for="filtroNome">Filtrar por Nome ou Sobrenome:</label>
                    <input type="text" id="filtroNome">
                </div>
                
                <div class="filtro-grupo">
                    <label for="filtroCidadePais">Filtrar por Cidade, Pa√≠s ou Local:</label>
                    <input type="text" id="filtroCidadePais">
                </div>
                
            </div>
            <!-- FIM DO CONTAINER DE FILTROS -->
            
            <div id="botoesAcaoGlobais">
                <button id="btnVisualizarSelecionado">üë®‚Äçüë©‚Äçüë¶‚Äçüë¶ Visualizar Fam√≠lia de: (assinalar)</button>
                <button id="btnExportarSelecionadosMD">üìù Gerar Relat√≥rio de dados (MD)</button>
            </div>
            <div id="registrosLista"></div>
        </section>
        
        <!-- O bloco secAniversariantes -->
        <section id="secAniversariantes" style="display:none;">
            <h2>üéÇ Aniversariantes do M√™s: <span id="mesAtual"></span></h2>
            <div id="aniversariantesLista">
                <!-- Lista de aniversariantes ser√° gerada aqui -->
                <p>Carregando aniversariantes...</p>
            </div>
        </section>

<section id="secVisualizarArvore">
    <h2 style="text-align: center;">√Årvore Geneal√≥gica - Visualiza√ß√£o</h2>
    
    <div style="text-align: center; margin-bottom: 20px;">
        <button onclick="abrirAlbum()" style="padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; display: inline-flex; align-items: center; gap: 8px;">
            üì∏ Ver Fotos de Grupos
        </button>
    </div>

    <div class="form-group">
        <label for="inputPessoaCentral">Buscar e selecionar a pessoa central da √°rvore:</label>
                <input type="text" id="inputPessoaCentral" list="listaPessoas" class="form-control" placeholder="Digite um nome para buscar...">
                <datalist id="listaPessoas">
                    </datalist>
            </div>

            
            <button id="btnEditarNaArvore" style="display: none; margin-top: 10px; background-color: #ee9b00;">‚úèÔ∏è Editar Pessoa Central</button>
            <div id="arvoreContainer"></div>
        </section>
        
        <section id="secEditarPessoa">
            <h2>Editar Registro</h2>
            <form id="editarForm">
                <!-- Campos de texto -->
                <label>Nome completo:</label>
                <input type="text" id="edit-nome">
                <label>Sexo:</label>
                <select id="edit-sexo">
                    <option value="">Selecione...</option>
                    <option value="M">Masculino</option>
                    <option value="F">Feminino</option>
                </select>
                <label>Nascimento:</label>
                <input type="text" id="edit-nascimento">
                <label>Falecimento:</label>
                <input type="text" id="edit-falecimento">
                <label>Profiss√£o:</label>
                <input type="text" id="edit-profissao">
                <label>Cidade/Pa√≠s principal:</label>
                <input type="text" id="edit-cidade_pais">

                <!-- CAMPO NOTAS -->
                <label>NOTAS (Uso Pessoal):</label>
                <textarea id="edit-observacoes" rows="4" style="width: 100%;"></textarea>
                
                <!-- Os campos de formul√°rio acabam aqui -->
            </form>
            

            <div id="vinculosSection" style="margin-top: 10px; padding-top: 30px; border-top: 1px solid #ddd;">
                <h3 id="labelNomePessoaEditada" class="vinculo-pessoa-nome">Editando Pessoa: [Nome]</h3>
                <h3>V√≠nculos Atuais:</h3>
                <div id="vinculosLista"></div>

                <div class="vinculo-creator">
                    <h3>Novo Vinculo:</h3>
                    <div id="escolha-v√≠nculo"></div>
                    <strong id="nomePessoaPrincipalVinculo" class="vinculo-pessoa-nome"></strong>
                    <select id="selectRelacao">
                        <option value="filho">√© filho(a) de</option>
                        <option value="pai">√© pai/m√£e de</option>
                        <option value="conjuge">√© c√¥njuge de</option>
                    </select>
                    <select id="selectPessoaVinculo">
                        <option value="">Selecione uma pessoa...</option>
                    </select>
                    <!-- Bot√£o de inclus√£o de v√≠nculo, com a string CONFIRMAR -->
                    <button type="button" id="btnAdicionarVinculo" class="botao-inclusao-vinculo">
                        CONFIRMAR
                    </button>
                </div>

            </div>

            <!-- REPOSICIONAMENTO DOS BOT√ïES: AGORA ELES EST√ÉO FORA DO FORMUL√ÅRIO DE EDI√á√ÉO -->
            <div style="margin-top: 30px; text-align: center; margin-bottom: 20px;">
                <!-- PONTO √öNICO DE SALVAMENTO NA MEM√ìRIA -->
                <button type="button" id="btnConcluirEdicoes" class="principal-button">
                    ‚úÖ Concluir Edi√ß√µes
                </button>
                <!-- Excluir e Cancelar -->
                <button type="button" id="btnExcluirRegistro" class="secundario-button">
                    Excluir Registro
                </button>
                <button type="button" id="btnCancelarEditar" class="secundario-button">
                    Cancelar
                </button>
            </div>
            <!-- FIM DO REPOSICIONAMENTO -->

        </section>
        
        <footer>
            <button id="btnExportarJSON">SALVAR DADOS</button>
            <button id="btnImportarJSON">CARREGAR</button>
            <button id="btnSalvarSupabase" style="display: none;">‚òÅÔ∏è Salvar na Nuvem</button>
            <button id="btnCarregarSupabase" style="display: none;">‚¨áÔ∏è Carregar da Nuvem</button>
            <button id="btnDicas" title="INSTRU√á√ïES">üí°</button>
            <input type="file" id="inputImportJSON" accept=".json,.txt" style="display: none;">
        </footer>
    </div>
    
    <!-- MODAL DE DICAS -->
    <div id="dicasModal" class="modal"> 
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3>Instru√ß√µes e Dicas</h3>
            <div class="dicas-nav">
                <button id="btnDicaAnterior" title="Dica anterior">&#9664;</button>
                <!-- SUBSTITU√çDO: "0 / 0" por um placeholder mais discreto -->
                <span id="dicaContador">Carregando...</span> 
                <button id="btnDicaProxima" title="Pr√≥xima dica">&#9654;</button>
            </div>
            <div class="dica-content-wrapper">
                <p id="dicaTexto">Carregando dicas...</p>
            </div>
        </div>
    </div>

<script>
function abrirAlbum() {
    // Redireciona para o arquivo do √°lbum na mesma pasta
    window.location.href = 'album_grupos.html';
}
</script>

</body>
</html>